# EC2とは

## EC2作成手順

1. AMIの選択
1. インスタンスタイプの選択
1. ストレージの追加
1. セキュリティグループの設定
1. SSHキーペアの設定

## AMIとは

* EC2インスタンス起動に必要な情報が入ったOSのイメージ。サーバのテンプレートのようなもの

## インスタンスタイプとは

* サーバのスペックを定義したもの

## ストレージ

* データの保存場所

### EBS
* EC2とは独立しているため付け替え可能
* stop/terminateしても保持可能
* OSやDBなどの永続性と耐久性が必要なデータを置く

### インスタンスストア
* EC2インスタンス専用の一時的なストレージ
* 付け替え不可
* stop/terminateするとデータが消える

## インスタンスの詳細設定
### 自動割り当てパブリックIP
* インターネット経由でアクセスできるグローバルIPをつけるか

### 配置グループ
* 複数EC2インスタンス間の通信を拘束化

### キャパシティ予約
* リソースを確保してくれるので上限超えて起動できなくなることを防げる

### IAMロール
* EC2インスタンスが他のサービスと連携する際の権限

### モニタリング
* 通常5分間隔を1分間隔に変更する

### T2/T3無制限
* CPUクレジットに関係なくバーストモードを無制限できるが課金制
* ベースラインはCPU1コアに対して10%でそれを下回っているとCPUクレジットが溜まる

### 高度な詳細
* EC2インスタンス起動時に実行されるスクリプトを定義できる

## ストレージの追加
### ボリュームタイプ
* ルートはOSが入っているストレージ
* ルートのストレージタイプはAMI選択時に決定している

### デバイス
* OSから見えるデバイス名

### スナップショット
* ストレージの中身（EBSは選択可）

### ボリュームタイプ
* ルートかEBSの場合に選択可能
* 汎用SSD：コスパいい。よく使われる
* プロビジョンドIOPS SSD：DBなど高いIOが必要な場合
* マグネティック：低いIOでも問題ない場合

### IOPS
* プロビジョンドIOPSが選択されている場合に設定可能でそのパフォーマンスを設定

### スループット
* 1秒間のデータ転送速度を設定する
* 汎用SSDの場合は設定できない

### 合わせて削除
* EC2インスタンスを削除した場合にEBSも削除してくれる

### 暗号化
* EBSボリュムの暗号化

## SSHとは
* 通信内容が暗号化された遠隔ログインシステム
* SSHクライアント -> SSHサーバ（SSHがインストールされて動作している）
* 公開鍵認証で他の人はログインできない
* 秘密鍵(pemファイル)を持っているユーザーのみが公開鍵を持っているサーバにログインできる

## 公開鍵認証フロー
1. 自分「ログインさせて」
1. サーバ「適当なデータを公開鍵で暗号化して送る」（暗号文）
1. 自分「秘密鍵で複合したデータを送る」（平文）
1. サーバ「合っていたらログインOK」
