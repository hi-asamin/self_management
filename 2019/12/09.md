# webレイヤを冗長化する
## 稼働率を上げる方法
* 要素単体の稼働率を高くする（限界がある）
* 要素を組み合わせて、全体の稼働率を高くする
* 負荷を適切なプロビジョニングで回避する

### 考え方
* 障害発生間隔を長くする
* 平均復旧時間を短くする

### 方法
* 冗長化
* 単一障害点（SPOF）をなくす（多重化されていない部分）

## 冗長化構成
### active-active
* 冗長化した両方が利用可能
* webサーバではこちらが多い

### active-standby
* 冗長化した片方が利用可能
* hot standby: スタンバイ側は普段起動しすぐに利用可能
* warm standby: スタンバイ側は普段起動しているが、利用するのに準備が必要
* cold standby: スタンバイ側は普段停止している
* DBサーバはデータの同期に時間がかかるためこちらが多い

## プロビジョニング
* アクセス数などを予測し適切にリソースを準備すること

### スケールアップ
* 個々の要素の性能を向上させる
* ある程度の規模まではスケールアップがコストパフォーマンスが良いが、一定範囲を過ぎると悪くなる

### スケールアウト
* 個々の要素を増やす
* ある程度の規模を超えそうであれば、スケールアウトで対応する
* 最低限用意しておくべきがN+1構成、安心なのはN+2構成（サービス提供に必要な台数+1〜2）

## サーバ構成のベストプラクティス
### 基本的な構成
* 一番最小限の構成は１台のサーバでWebとDBを運用する
* webサーバ:1、DBサーバ:1
* webサーバ:2、DBサーバ:1(Webサーバはユーザー数に応じて負荷が増えるから)
* webサーバ:2、DBサーバ:2（マルチAZ構成）

## ELBとは
### 概要
* 複数のEC2インスタンスに負荷分散する
* 複数のAZにある複数のEC2インスタンスの中から正常なターゲットにのみ振り分ける（ヘルスチェック）

### 特徴
* スケーラブル：ELB自体も負荷に応じて自動でスケールアウト・スケールインする
* AZをまたがる構成：ELBを利用する場合、1つのリージョンを選び、そのリージョン内のAZはまたがるように構成ができる
* 名前解決：ELBにはDNSが割り当てられる。ELBへの接続ポイントへのアクセスにはDNSを使用する
* 安価な従量課金：従量課金で利用可能
* マネージドサービス：運用が楽


